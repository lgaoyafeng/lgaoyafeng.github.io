<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="千里之行,始于足下"><meta name="keywords" content=""><meta name="author" content="丰之霸"><meta name="copyright" content="丰之霸"><title>Hexo</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">丰之霸</div><div class="author-info__description text-center">千里之行,始于足下</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">30</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">2</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Hexo</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Hexo</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/%E4%BA%8C%E5%8F%89%E5%A0%86%E4%BB%A5%E5%8F%8A%E5%A0%86%E6%8E%92%E5%BA%8F/">二叉堆以及堆排序</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h1 id="1-二叉堆"><a href="#1-二叉堆" class="headerlink" title="1. 二叉堆"></a>1. 二叉堆</h1><h3 id="什么是二叉堆"><a href="#什么是二叉堆" class="headerlink" title="什么是二叉堆"></a>什么是二叉堆</h3><p>二叉堆本质上是一种完全二叉树, 它分为两个类型</p>
<ul>
<li>最大堆</li>
<li>最小堆</li>
</ul>
<p>最大堆: 堆的每一个父节点都大于或等于他的左子节点和右子节点</p>
<p>最小堆: 堆的每一个父节点都小于或等于他的左子节点和右子节点</p>
<p>​        二叉堆的根节点叫做堆顶, 最大堆和最小堆的特性决定了,最大堆的顶点是整个堆中元素的最大值,最小堆的顶点是整个堆中元素的最小值</p>
<h3 id="二叉堆的自我调整"><a href="#二叉堆的自我调整" class="headerlink" title="二叉堆的自我调整"></a>二叉堆的自我调整</h3><p>​        二叉堆的几种操作</p>
<ul>
<li>插入</li>
<li>删除</li>
<li>构建二叉堆</li>
</ul>
<p>​        这几种操作都是基于堆的自我调整, 就是把一个不符合堆性质的完全二叉堆, 调整成一个堆, 下面让我们已最小堆为例, 看一个二叉堆是如何调整的</p>
<ol>
<li><p>插入节点</p>
<p>​    当二叉堆插入节点时，插入位置是完全二叉树的最后一个位置。例如插入一个 新节点，值是 0。这时，新节点的父节点5比0大，显然不符合最小堆的性质。于是让新节点“上 浮”，和父节点交换位置。继续用节点0和父节点3做比较，因为0小于3，则让新节点继续“上浮”。继续比较，最终新节点0“上浮”到了堆顶位置。</p>
</li>
<li><p>删除节点</p>
<p>​        二叉堆删除节点的过程和插入节点的过程正好相反，所删除的是处于堆顶的节 点。例如删除最小堆的堆顶节点1。这时，为了继续维持完全二叉树的结构，我们把堆的最后一个节点10临时补到 原本堆顶的位置。接下来，让暂处堆顶位置的节点10和它的左、右孩子进行比较，如果左、右孩 子节点中最小的一个（显然是节点2）比节点10小，那么让节点10“下沉”。继续让节点10和它的左、右孩子做比较，左、右孩子中最小的是节点7，由于10 大于7，让节点10继续“下沉”。这样一来，二叉堆重新得到了调整。</p>
</li>
<li><p>构建二叉堆</p>
<p>构建二叉堆，也就是把一个无序的完全二叉树调整为二叉堆，本质就是让所有 非叶子节点依次“下沉”。首先，从最后一个非叶子节点开始，也就是从节点10开始。如果节点10大于它 左、右孩子节点中最小的一个，则节点10“下沉”。接下来轮到节点3，如果节点3大于它左、右孩子节点中最小的一个，则节点 3“下沉”。然后轮到节点1，如果节点1大于它左、右孩子节点中最小的一个，则节点1“下 沉”。事实上节点1小于它的左、右孩子，所以不用改变。经过上述几轮比较和“下沉”操作，最终每一节点都小于它的左、右孩子节 点，一个无序的完全二叉树就被构建成了一个最小堆。</p>
</li>
</ol>
<h3 id="二叉堆的代码实现"><a href="#二叉堆的代码实现" class="headerlink" title="二叉堆的代码实现"></a>二叉堆的代码实现</h3><p>​        在展示代码之前，我们还需要明确一点：二叉堆虽然是一个完全二叉树，但它 的存储方式并不是链式存储，而是顺序存储。换句话说，二叉堆的所有节点都存储 在数组中.</p>
<p>​        在数组中，在没有左、右指针的情况下，如何定位一个父节点的左孩子和右孩 子呢？假设父节点的下标是parent，那么它的左孩子下标就是 2×parent+1；右孩子 下标就是2×parent+2。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 上浮调整,</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> array 待调整的堆</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upAdjust</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> childIndex = array.length - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">int</span> parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">       <span class="comment">//temp 保存插入的子叶节点的值,用于最后赋值</span></span><br><span class="line">       <span class="keyword">int</span> temp = array[array.length - <span class="number">1</span>];</span><br><span class="line">       <span class="comment">//当上浮到顶点之前,切该值比父节点的值小,进行赋值</span></span><br><span class="line">       <span class="keyword">while</span> (childIndex &gt; <span class="number">0</span> &amp;&amp; temp &lt; array[parentIndex]) &#123;</span><br><span class="line">           <span class="comment">//不需换值,直接赋值即可,最后一次在填入值</span></span><br><span class="line">           array[childIndex] = array[parentIndex];</span><br><span class="line">           childIndex = parentIndex;</span><br><span class="line">           parentIndex = (parentIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//因为是在进行子父节点的运算后退出的循环,所以这里的childIndex才是最后需要换值得节点</span></span><br><span class="line">       array[childIndex] = temp;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * "下沉调整"</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> array       待调整的堆</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> parentIndex 要下沉的父节点</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> length      堆的有效大小</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> parentIndex, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//保存父节点的值,用于最后赋值</span></span><br><span class="line">       <span class="keyword">int</span> temp = array[parentIndex];</span><br><span class="line">       <span class="keyword">int</span> childIndex = <span class="number">2</span> * parentIndex + <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span> (childIndex &lt; length) &#123;</span><br><span class="line">           <span class="comment">//如果有右孩子,且右孩子的值小于左孩子的值,则定位右孩子</span></span><br><span class="line">           <span class="keyword">if</span> (childIndex + <span class="number">1</span> &lt; length &amp;&amp; array[childIndex + <span class="number">1</span>] &lt; array[childIndex]) &#123;</span><br><span class="line">               childIndex++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//如果父节点小于任何一个孩子的值,立刻跳出</span></span><br><span class="line">           <span class="keyword">if</span> (array[parentIndex] &lt; array[childIndex]) &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//条件判断结果未true后,节点下沉</span></span><br><span class="line">           array[parentIndex] = array[childIndex];</span><br><span class="line">           parentIndex = childIndex;</span><br><span class="line">           childIndex = childIndex * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       array[parentIndex] = temp;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 构建堆</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> array 待调整的堆</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildHeap</span><span class="params">(<span class="keyword">int</span>[] array)</span></span>&#123;</span><br><span class="line">       <span class="comment">//从最后一个非叶子节点开始,依次进行下沉调整</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i =(array.length-<span class="number">2</span>)/<span class="number">2</span> ; i &gt;=<span class="number">0</span> ; i--) &#123;</span><br><span class="line">           downAdjust(array,i, array.length);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">0</span>&#125;;</span><br><span class="line">       upAdjust(array);</span><br><span class="line">       System.out.println(Arrays.toString(array));</span><br><span class="line"></span><br><span class="line">       array = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>&#125;;</span><br><span class="line">       buildHeap(array);</span><br><span class="line"></span><br><span class="line">       System.out.println(Arrays.toString(array));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-优先队列"><a href="#2-优先队列" class="headerlink" title="2.优先队列"></a>2.优先队列</h1><h5 id="优先队列不再遵循先入先出的原则，而是分为两种情况。-最大优先队列，无论入队顺序如何，都是当前最大的元素优先出队-最小优先队列，无论入队顺序如何，都是当前最小的元素优先出队"><a href="#优先队列不再遵循先入先出的原则，而是分为两种情况。-最大优先队列，无论入队顺序如何，都是当前最大的元素优先出队-最小优先队列，无论入队顺序如何，都是当前最小的元素优先出队" class="headerlink" title="优先队列不再遵循先入先出的原则，而是分为两种情况。 最大优先队列，无论入队顺序如何，都是当前最大的元素优先出队 最小优先队列，无论入队顺序如何，都是当前最小的元素优先出队"></a>优先队列不再遵循先入先出的原则，而是分为两种情况。 最大优先队列，无论入队顺序如何，都是当前最大的元素优先出队 最小优先队列，无论入队顺序如何，都是当前最小的元素优先出队</h5><p>​        先来回顾一下二叉堆的特性。 1. 最大堆的堆顶是整个堆中的最大元素。 2. 最小堆的堆顶是整个堆中的最小元素。 因此，可以用最大堆来实现最大优先队列，这样的话，每一次入队操作就是堆 的插入操作，每一次出队操作就是删除堆顶节点</p>
<p>以下为代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码实现的是最大堆,所以出队的顺序是从大到小 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化数组长度</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">32</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入队</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (array.length &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">        array[size++] = key;</span><br><span class="line">        upAdjust();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出队</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deQueue</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"the queue is empty"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> head = array[<span class="number">0</span>];</span><br><span class="line">        array[<span class="number">0</span>] = array[--size];</span><br><span class="line">        downAdjust();</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//用temp保存父节点的值,用于最后赋值</span></span><br><span class="line">        <span class="keyword">int</span> parentIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> temp = array[parentIndex];</span><br><span class="line">        <span class="keyword">int</span> childIndex = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (childIndex &lt; size) &#123;</span><br><span class="line">            <span class="comment">// 如果有右孩子,且右孩子的值大于左孩子的值, 则定位到左孩子</span></span><br><span class="line">            <span class="keyword">if</span> (childIndex + <span class="number">1</span> &lt; size &amp;&amp; array[childIndex + <span class="number">1</span>] &gt; array[childIndex]) &#123;</span><br><span class="line">                childIndex++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果父节点大于任何一个孩子的值,则跳出</span></span><br><span class="line">            <span class="keyword">if</span> (temp &gt; array[childIndex]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//判断结束,进行换值</span></span><br><span class="line">            array[parentIndex] = array[childIndex];</span><br><span class="line">            parentIndex = childIndex;</span><br><span class="line">            childIndex = parentIndex * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        array[parentIndex] = temp;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">upAdjust</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> childIndex = size - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> parentIndex = (childIndex - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//temp用于保存叶子节点的值,用于最后的赋值</span></span><br><span class="line">        <span class="keyword">int</span> temp = array[childIndex];</span><br><span class="line">        <span class="keyword">while</span> (childIndex &gt; <span class="number">0</span> &amp;&amp; temp &gt; array[parentIndex]) &#123;</span><br><span class="line">            array[childIndex] = array[parentIndex];</span><br><span class="line">            childIndex = parentIndex;</span><br><span class="line">            parentIndex = parentIndex / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[childIndex] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数组扩容的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> newSize = array.length * <span class="number">2</span>;</span><br><span class="line">        array = Arrays.copyOf(<span class="keyword">this</span>.array, newSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        PriorityQueue priorityQueue = <span class="keyword">new</span> PriorityQueue();</span><br><span class="line">        priorityQueue.enQueue(<span class="number">3</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">6</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">78</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">213</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">45</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">456</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">78</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">76</span>);</span><br><span class="line">        priorityQueue.enQueue(<span class="number">8524</span>);</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">        System.out.println(<span class="string">" 出队元素："</span> + priorityQueue.deQueue());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-堆排序"><a href="#3-堆排序" class="headerlink" title="3. 堆排序"></a>3. 堆排序</h1><p>​        把无序数组构建成二叉堆。需要从小到大排序，则构建成最大堆；需要从大 到小排序，则构建成最小堆。 2. 循环删除堆顶元素，替换到二叉堆的末尾，调整堆产生新的堆顶</p>
<p>​        代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 下沉调整</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> array       要调整的堆</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> parentIndex 待下沉的父节点</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> length      堆的有效大小</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> parentIndex, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//保存父节点的值,用于最后赋值</span></span><br><span class="line">       <span class="keyword">int</span> temp = array[parentIndex];</span><br><span class="line">       <span class="keyword">int</span> childIndex = parentIndex * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span> (childIndex &lt; length) &#123;</span><br><span class="line">           <span class="comment">//如果有右孩子,且右孩子的值大于左孩子的值,则定位右孩子</span></span><br><span class="line">           <span class="keyword">if</span> (childIndex + <span class="number">1</span> &lt; length &amp;&amp; array[childIndex + <span class="number">1</span>] &gt; array[childIndex]) &#123;</span><br><span class="line">               childIndex++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//如果父节点的值大于每一个子节点的值,直接跳出</span></span><br><span class="line">           <span class="keyword">if</span> (temp &gt; array[childIndex]) &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 判断结束进行换值</span></span><br><span class="line">           array[parentIndex] = array[childIndex];</span><br><span class="line">           parentIndex = childIndex;</span><br><span class="line">           childIndex = childIndex * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       array[parentIndex] = temp;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 堆排序(升序)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span>[] array)</span></span>&#123;</span><br><span class="line">       <span class="comment">//把无序数组构建成最大堆</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = (array.length-<span class="number">2</span>)/<span class="number">2</span>; i &gt;=<span class="number">0</span> ; i--) &#123;</span><br><span class="line">           downAdjust(array,i, array.length);</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(Arrays.toString(array));</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 循环的删除堆顶元素, 移到集合尾部, 调整堆产生新的堆</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = array.length-<span class="number">1</span>; i &gt;<span class="number">0</span> ; i--) &#123;</span><br><span class="line">           <span class="comment">// 最后1个元素和第1个元素进行交换</span></span><br><span class="line">           <span class="keyword">int</span> temp = array[i];</span><br><span class="line">           array[i] = array[<span class="number">0</span>];</span><br><span class="line">           array[<span class="number">0</span>] = temp;</span><br><span class="line">           <span class="comment">// “下沉”调整最大堆</span></span><br><span class="line">           downAdjust(array, <span class="number">0</span>, i);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">0</span>&#125;;</span><br><span class="line">       heapSort(arr);</span><br><span class="line">       System.out.println(Arrays.toString(arr));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="堆排序算法的步骤"><a href="#堆排序算法的步骤" class="headerlink" title="堆排序算法的步骤"></a>堆排序算法的步骤</h4><p>​        把无序数组构建成二叉堆。 2. 循环删除堆顶元素，并将该元素移到集合尾部，调整堆产生新的堆顶。 第1步，把无序数组构建成二叉堆，这一步的时间复杂度是O(n)。 第2步，需要进行n-1次循环。每次循环调用一次downAdjust方法，所以第2步 的计算规模是 (n-1)×logn ，时间复杂度为O(nlogn)。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/ssh%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/">ssh踩坑经历</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h1 id="SSH项目总结"><a href="#SSH项目总结" class="headerlink" title="SSH项目总结"></a>SSH项目总结</h1><p>在前端的对应的标签上添加对应的<code>js</code>函数(),在外部单独的定义这个js函数</p>
<p><code>&lt;dl&gt;   &lt;dt    onclick=&quot;this.parentNode.className=this.parentNode.className==&#39;open&#39;?&#39;&#39;:&#39;open&#39;;&quot;&gt;订单业务  &lt;/dt&gt;   &lt;dd&gt;&lt;a href=&quot;javascript:all_order()&quot;&gt;所有订单&lt;/a&gt;&lt;/dd&gt;   &lt;dd&gt;&lt;a href=&quot;javascript:addnew()&quot;&gt;新增订单&lt;/a&gt;&lt;/dd&gt;   &lt;dd&gt;&lt;a href=&quot;javascript:delete_by_id()&quot;&gt;删除订单&lt;/a&gt;&lt;/dd&gt;&lt;/dl&gt;</code>,</p>
<p>后面对应的是对应的action的方法实现</p>
<p><code>function all_order(){             document.getElementById(&quot;iframe&quot;).src = &quot;torderfindAll&quot;;         }</code></p>
<p>​        然后请求就会根据给定的路径去找对应的action(<code>torderfindAll</code>代表名为<code>torder</code>的action的<code>findALL</code>方法),执行方法之后,将查询到的信息封装到session中,执行结束后,会根据方法与<code>jsp</code>的对应关系,将该session中储存的信息回填到<code>jsp</code>页面中展示给用户.</p>
<h2 id="对应关系"><a href="#对应关系" class="headerlink" title="对应关系 :"></a>对应关系 :</h2><h3 id="以下是各个层之间的对应关系"><a href="#以下是各个层之间的对应关系" class="headerlink" title="以下是各个层之间的对应关系 :"></a>以下是各个层之间的对应关系 :</h3><p>在这个文件夹中 applicationContext.xml</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- TOrder dao --&gt;&lt;bean id="OrderDaoImpl" class="com.accp.dao.impl.OrderDaoImpl"&gt;   &lt;property name="sessionFactory" ref="sessionFactory" /&gt;&lt;/bean&gt;&lt;!-- biz --&gt;&lt;bean id="OrderBizImpl" class="com.accp.biz.impl.OrderBizImpl"&gt;   &lt;property name="orderDao" ref="OrderDaoImpl" /&gt;&lt;/bean&gt;&lt;!-- action --&gt;&lt;bean id="OrderAction" class="com.accp.action.OrderAction" scope="prototype"&gt;   &lt;property name="orderBiz" ref="OrderBizImpl" /&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h3 id="hibernate-cfg-xml-的配置-里面需要配置连接数据库的信息"><a href="#hibernate-cfg-xml-的配置-里面需要配置连接数据库的信息" class="headerlink" title="hibernate.cfg.xml 的配置,里面需要配置连接数据库的信息"></a>hibernate.cfg.xml 的配置,里面需要配置连接数据库的信息</h3><p>里面还会配置数据库表对应的实体类信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-configuration</span> <span class="meta-keyword">PUBLIC</span>        <span class="meta-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>        <span class="meta-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span>    <span class="comment">&lt;!--&lt;property name="connection.driver_class"&gt;oracle.jdbc.driver.OracleDriver&lt;/property&gt;--&gt;</span>    <span class="comment">&lt;!--&lt;property name="connection.url"&gt;jdbc:oracle:thin:@localhost:1521:hibernate_office&lt;/property&gt;--&gt;</span>   <span class="comment">&lt;!--&lt;property name="connection.username"&gt;office&lt;/property&gt;--&gt;</span>   <span class="comment">&lt;!--&lt;property name="connection.password"&gt;office&lt;/property&gt;--&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.url"</span>&gt;</span>jdbc:mysql://119.23.31.181:3306/ssh_office<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.username"</span>&gt;</span>xuhong<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.password"</span>&gt;</span>xuhong<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.OracleDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="comment">&lt;!--&lt;property name="connection.driver_class"&gt;oracle.jdbc.driver.OracleDriver&lt;/property&gt;--&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.min_size"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.timeout"</span>&gt;</span>5000<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_statements"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.idle_test_period"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.acquire_increment"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myeclipse.connection.profile"</span>&gt;</span>ssh_office<span class="tag">&lt;/<span class="name">property</span>&gt;</span>   <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">class</span>=<span class="string">"com.accp.pojo.Users"</span> /&gt;</span>   <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">class</span>=<span class="string">"com.accp.pojo.TOrder"</span> /&gt;</span>   <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">class</span>=<span class="string">"com.accp.pojo.Email"</span> /&gt;</span>   <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">class</span>=<span class="string">"com.accp.pojo.Vacation"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="strus-xml的配置"><a href="#strus-xml的配置" class="headerlink" title="strus.xml的配置"></a>strus.xml的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- /* 原始 struts2 */ &lt;action name="user*" class="com.accp.demo.action.UserinfoAction" method="&#123;1&#125;"&gt; &lt;result name="ok"&gt;/ok.jsp&lt;/result&gt;    &lt;result name="err"&gt;/err.jsp&lt;/result&gt; &lt;result name="back" type="redirect"&gt;/index.jsp&lt;/result&gt; &lt;/action&gt; --&gt;</span><span class="comment">&lt;!-- 现在交由Spring,class 应该写applicationContext.xml中 action 的 ID --&gt;</span><span class="comment">&lt;!-- user action --&gt;</span><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user*"</span> <span class="attr">class</span>=<span class="string">"UsersAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"relogin"</span>&gt;</span>/<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"out"</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>/<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"update"</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"updatePwd"</span>&gt;</span>/account.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"selectFirstPage"</span>&gt;</span>/account_list.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"selectNextPage"</span>&gt;</span>/account_list.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"add"</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span>userselectFirstPage<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"delete"</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span>userselectFirstPage<span class="tag">&lt;/<span class="name">result</span>&gt;</span>   <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><action>标签中的那么表示所有user开头的请求的对应关系都在这里配置,class是对应的action类</p>
<p><result>标签中的name是对应的action中具体的方法名,标签中间的<code>xxx.jsp</code>是是该方法对应的<code>jsp</code>文件</p>
<h3 id="实体类与数据库表的对应关系"><a href="#实体类与数据库表的对应关系" class="headerlink" title="实体类与数据库表的对应关系 :"></a>实体类与数据库表的对应关系 :</h3><ul>
<li><input disabled="" type="checkbox"> <pre><code class="xml"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hibernate-mapping</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span><span class="meta-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span>    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.accp.pojo.TOrder"</span> <span class="attr">table</span>=<span class="string">"t_order"</span>&gt;</span>        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">length</span>=<span class="string">"30"</span> /&gt;</span>            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"assigned"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">id</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">length</span>=<span class="string">"30"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">length</span>=<span class="string">"30"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"orderType"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"order_type"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"status"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"status"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"picture"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"picture"</span> <span class="attr">length</span>=<span class="string">"150"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"createUser"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"create_user"</span> <span class="attr">length</span>=<span class="string">"30"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"createTime"</span> <span class="attr">type</span>=<span class="string">"java.sql.Timestamp"</span>&gt;</span>            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"create_time"</span> <span class="attr">length</span>=<span class="string">"30"</span> /&gt;</span>        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>        <span class="comment">&lt;!--       &lt;set name="emails"&gt;         &lt;key cloumn="RECIPIENTS"&gt;&lt;/key&gt;         &lt;one-to-many class="com.accp.pojo.Email"/&gt;      &lt;/set&gt; --&gt;</span><span class="comment">&lt;!--       &lt;set name="vacations"&gt;         &lt;key cloumn="NAME"&gt;&lt;/key&gt;         &lt;one-to-many class="com.accp.pojo.Vacation"/&gt;      &lt;/set&gt; --&gt;</span>    <span class="tag">&lt;/<span class="name">class</span>&gt;</span><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></code></pre>
</li>
</ul>
<p><class name="com.accp.pojo.TOrder" table="t_order">其中的name表示实体类的全类名,table表示的是表名,而且必须将需要查询的的所有字段与实体类对应起来(包括数据类型的匹配),否则查询不到</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/SSH%E6%A1%86%E6%9E%B6/">SSH框架</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><p>1.加入Spring</p>
<p>2.加入Hibernate</p>
<p>3.同时持久化类,和对应的.hbm.xml文件</p>
<p>4.Spring整合Hibernate</p>
<p>5.加入Strust2</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">redis配置文件</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h2 id="redis-conf配置"><a href="#redis-conf配置" class="headerlink" title="redis.conf配置"></a>redis.conf配置</h2><p>redis.conf配置说明如下 ：</p>
<ol>
<li>Redis默认不是以守护线程的方式运行,可以通过该配置项修改,使用yes启用守护线程, daemonize</li>
</ol>
<p>yes</p>
<ol start="2">
<li><p>当Redis以守护线程运行时,Redis默认会把pid写入/run/redis.pid文件,可以通过profile指定 pidfile/var/run/redis.pid</p>
</li>
<li><p>指定Redis监听端口,默认端口为6379,作者在自己的一篇博文中解释了为什么选用6379作为端口,因为6379在手机上上的按键MERZ的对应的号码,而MERZ取自意大利歌女Alessia Merz的名字 </p>
</li>
</ol>
<p>port 6379</p>
<ol start="4">
<li>绑定的主机地址 : bind 127.0.0.1</li>
</ol>
<p>​     假如需要远程访问的话需将其注释<code>#</code>,或者改为0.0.0.0</p>
<ol start="5">
<li><p>当客户端闲置多长时间后关闭连接,如果时间为0,表示关闭该功能, timeout 300</p>
</li>
<li><p>指定日志记录级别,Redis总共支持四个级别: debug, verbose, notice, warning, 摩尔恩为verbose</p>
</li>
<li><p>日志记录方式,默认为标准输出, 如果配置Redis为守护线程方式运行,而这里又配置为日志记录方式为标注输出,则日志会发送给/dev/null/logfile stdout</p>
</li>
<li><p>设置数据库的数量,默认数据库为0,可以使用SELECT<dbid>命令在连接指定数据库id</p>
<p>database 16</p>
</li>
<li><p>指定在多长时间内,有多少次更新操作,就讲数据同步到数据文件,可以多个条件配合 save<seconds><changes></p>
</li>
</ol>
<p>redis默认配置文件中提供了三个条件 :</p>
<p>save 900 1 </p>
<p>save 300 10</p>
<p>save 60 10000</p>
<p>分别表示900秒(15分钟)内有1个更改,300秒(5分钟)内有10个更改以及60秒有10000个更改</p>
<ol start="10">
<li><p>指定存储至本地数据库时是否压缩数据,默认为YES,Redis采用LZF压缩,如果为了节省CPU时间,可以关闭该选项, 但会导致数据库文件变的巨大, rdbcompression yes</p>
</li>
<li><p>指定本地数据库文件名, 默认值为 dump.db    dbfilename dump.db</p>
</li>
<li><p>指定本地数据库存放目录     dir./</p>
</li>
<li><p>设置当本机为slav服务时, 设置master服务的IP地址及端口,在Redis启动时, 它会主动从master进行数据同步,  slaveof<masterip><masterport></p>
</li>
<li><p>当master服务设置了密码保护时,salv服务连接master的密码    masterauth <master-password></p>
</li>
<li><p>设置Redis连接密码,如果配置了连接密码,客户端在连接Redis时需要通过 AUTH<password>命令提供密码,默认关闭  requirepass fobared</p>
</li>
<li><p>设置同一时间最大客户端连接数,默认无限制,Redis可以同时打开的客户端数为为Redis进程可以打开的最大文件描述符数,如果设置maxclients 0, 如果不做限制.当客户端连接数达到限制时,Redis会关闭新的连接并向客户端返回 max number of clients reched错误信息</p>
</li>
<li><p>指定Redis最大内存限制,Redis在启动时会把数据加载到内存中, 达到最大内存后, Redis会先尝试清楚已到期或即将到期的key, 当此方法处理后,仍达到最大内存设置,将无法再进行写入操作,但仍可以进行读取操作,Redis新的vm机制,会把key存到内存,value存到swap区 maxmemory<bytes></p>
</li>
<li><p>指定是否每次更新操作后进行日志同步记录, Redis在默认情况下是异步的把数据写入磁盘, 如果不开启, 可能会在断电时导致一段时间内的数据消失. 因为Redis本身同步数据文件是按上面save条件来同步的,所以有的数据会在一段时间内只存在内存中,默认为 no    appendonly no</p>
</li>
<li><p>指定更新日志文件名, 默认为appendonly.aof      apppendfiename appendonly.aof</p>
</li>
<li><p>指定跟新日志条件, 共有3个可选值 : </p>
</li>
<li><p>no : 表示等操作系统进行数据缓存同步到磁盘</p>
<p>always : 表示你每次更新操作后手动地调用fsnc()将数据写到磁盘(慢,安全)</p>
<p>everysec : 表示每秒同步一次 (折中,默认值)</p>
</li>
<li><p>虚拟内存文件路径, 默认值为 /tem/redis.swap, 不可多个Redis实例共享 vm-swap-file/temp/redis.swap</p>
</li>
<li><p>将所有大于vm-max-momory的数据存入虚拟内存,无论vm-max-memory设置多小, 所有索引数据都是内存存储的(Redis的索引数据就是keys),也就是说,当vm-max-memory设置为0的时候,其实所有value都存在于磁盘,默认值为0     vm-max-memory 0 </p>
</li>
<li><p>Redis swap文件分成了很多的page,一个对象可以保存多个page上面, 但一个page上不能被多个对象共享, vm-page-size是要根据储存的数据大小来设定的, 作者建议如果存储很多小对象,page的大小最好设置为32或者64bytes;如果存储很大对象,则可以使用更大的page,如果不确定, 就使用默认值  vm-page-size 32</p>
</li>
<li><p>设置swap文件中的page数量,由于页表(一种表示页面空闲或使用的bitmap)是放在内存中的, 在磁盘上每8个pages将消耗一个byte的内存, vm-pages 134217728</p>
</li>
<li><p>设置访问swap问价你的线程数,最好不要超过及其的核数, 如果设置为0, 那么所有的swap文件都是串行的, 可能会造成比较长的延迟,默认值为4 vm-max-threads 4 </p>
</li>
<li><p>上设置在向客户端应答时,是否把较小的包合并为一个包发送,默认为开启,  glueoutputbuf     yes</p>
</li>
<li><p>指定在超过一定的数量户或者最大的元素超过某一临界值时,采用一种特殊的哈希算法, hash-max-zipmap-entries   64        hash-max-zipmap-values  512</p>
</li>
<li><p>指定是否激活重置哈希,默认为开启   activerehashing yes</p>
</li>
<li><p>指定包含其他的配置文件, 可以在同一主机上多个Redis实例主键使用同一配置文件, 而同时各个实例又拥有自己的特定配置文件, include /path / to/local.conf</p>
<h4 id="总结-在linux系统上-配置文件很重要-因为没有图形界面-所以几乎所以所有的更改配置的操作都是通过修改配置文件来完成的-等同于windows的设置-在更改的时候最好将配置文件-xxxx-conf单独copy一份来修改-这样可以避免修改错误不能回滚-修改完成后可以通过这份新的配置文件来启动应用-达到修改配置的目的"><a href="#总结-在linux系统上-配置文件很重要-因为没有图形界面-所以几乎所以所有的更改配置的操作都是通过修改配置文件来完成的-等同于windows的设置-在更改的时候最好将配置文件-xxxx-conf单独copy一份来修改-这样可以避免修改错误不能回滚-修改完成后可以通过这份新的配置文件来启动应用-达到修改配置的目的" class="headerlink" title="总结  : 在linux系统上,配置文件很重要,因为没有图形界面,所以几乎所以所有的更改配置的操作都是通过修改配置文件来完成的,等同于windows的设置,在更改的时候最好将配置文件 xxxx.conf单独copy一份来修改,这样可以避免修改错误不能回滚,修改完成后可以通过这份新的配置文件来启动应用,达到修改配置的目的"></a>总结  : 在linux系统上,配置文件很重要,因为没有图形界面,所以几乎所以所有的更改配置的操作都是通过修改配置文件来完成的,等同于windows的设置,在更改的时候最好将配置文件 xxxx.conf单独copy一份来修改,这样可以避免修改错误不能回滚,修改完成后可以通过这份新的配置文件来启动应用,达到修改配置的目的</h4></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/Redis%E6%8C%81%E4%B9%85%E5%8C%96/">Redis持久化</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h2 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h2><h3 id="RDB-Redis-database"><a href="#RDB-Redis-database" class="headerlink" title="RDB(Redis database)"></a>RDB(Redis database)</h3><p>定义 :  在指定的时间间隔内将内存中的数据集快照写入磁盘,也就是行话讲的Snapshot快照,它恢复时2是将快照文件直接读到内存里</p>
<pre><code>Redis会单独创建(fork)一个子进程来进行持久化,会先将数据写入到一个临时文件中,待持久化过程都结束了,再用这个临时文件替换上次持久化好的文件,整个过程中,主进程是不进行任何IO操作的</code></pre><h3 id="AOF-Append-Only-File"><a href="#AOF-Append-Only-File" class="headerlink" title="AOF(Append Only File)"></a>AOF(Append Only File)</h3></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/Redis/">Redis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><code>Redis</code></h2><h3 id="非关系型数据库的四种形式"><a href="#非关系型数据库的四种形式" class="headerlink" title="非关系型数据库的四种形式"></a>非关系型数据库的四种形式</h3><p>键值 : <code>Redis</code></p>
<p>列存储数据库 : <code>HBase</code></p>
<p>文档型数据库 : <code>MongoDB</code></p>
<p>图形数据库 : <code>Neo4J</code>,<code>infoGrid</code></p>
<h3 id="传统数据库的四大特性"><a href="#传统数据库的四大特性" class="headerlink" title="传统数据库的四大特性"></a>传统数据库的四大特性</h3><p>ACID</p>
<p><code>Atomictiy</code> : 原子性</p>
<p><code>Consistency</code> :  一致性</p>
<p><code>Isolation</code> :  独立性</p>
<p><code>Durability</code> :  持久性</p>
<h3 id="非关系型数据库"><a href="#非关系型数据库" class="headerlink" title="非关系型数据库"></a>非关系型数据库</h3><p>CAP</p>
<p><code>Consistency</code> : 强一致性</p>
<p><code>Availability</code> : 可用性</p>
<p><code>Partiton  tolerance</code>: 分区容错性</p>
<p>只能满足两个</p>
<h3 id="入门概述"><a href="#入门概述" class="headerlink" title="入门概述"></a>入门概述</h3><h4 id="3V-3高"><a href="#3V-3高" class="headerlink" title="3V+3高 :"></a>3V+3高 :</h4><h5 id="大数据时代的3v"><a href="#大数据时代的3v" class="headerlink" title="大数据时代的3v:"></a>大数据时代的3v:</h5><p>1.海量(Volume)</p>
<p>2.多样(Variety)</p>
<p>3.实时(Velocity)</p>
<h5 id="互联网时代的3高"><a href="#互联网时代的3高" class="headerlink" title="互联网时代的3高:"></a>互联网时代的3高:</h5><p>1.高并发</p>
<p>2.高可扩</p>
<p>3.高性能</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/MybatisPlus/">MybatisPlus</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h1 id="MybatisPlus"><a href="#MybatisPlus" class="headerlink" title="MybatisPlus"></a><code>MybatisPlus</code></h1><h1 id="一、wapper介绍"><a href="#一、wapper介绍" class="headerlink" title="一、wapper介绍"></a><strong>一、wapper介绍</strong></h1><p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/a07491cb-f54d-4437-870e-b4a9443eecac/128/index_files/27b56b5e-39a6-42ba-b7ed-4f109b6ad7bf.png)</p>
<p>Wrapper ： 条件构造抽象类，最顶端父类</p>
<p>  AbstractWrapper ： 用于查询条件封装，生成 sql 的 where 条件</p>
<p>​    QueryWrapper ： Entity 对象封装操作类，不是用lambda语法</p>
<p>​    UpdateWrapper ： Update 条件封装，用于Entity对象更新操作</p>
<p>  AbstractLambdaWrapper ： Lambda 语法使用 Wrapper统一处理解析 lambda 获取 column。</p>
<p>​    LambdaQueryWrapper ：看名称也能明白就是用于Lambda语法使用的查询Wrapper</p>
<p>​    LambdaUpdateWrapper ： Lambda 更新封装Wrapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class QueryWrapperTests &#123;</span><br><span class="line">    </span><br><span class="line">    @Autowired</span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、AbstractWrapper"><a href="#二、AbstractWrapper" class="headerlink" title="二、AbstractWrapper"></a>二、AbstractWrapper</h1><p>**<br><strong>**注意：</strong>以下条件构造器的方法入参中的 <code>column</code>均表示数据库字段</p>
<h2 id="1、ge、gt、le、lt、isNull、isNotNull"><a href="#1、ge、gt、le、lt、isNull、isNotNull" class="headerlink" title="1、ge、gt、le、lt、isNull、isNotNull"></a><strong>1、ge、gt、le、lt、isNull、isNotNull</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDelete() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper</span><br><span class="line">        .isNull(&quot;name&quot;)</span><br><span class="line">        .ge(&quot;age&quot;, 12)</span><br><span class="line">        .isNotNull(&quot;email&quot;);</span><br><span class="line">    int result &#x3D; userMapper.delete(queryWrapper);</span><br><span class="line">    System.out.println(&quot;delete return count &#x3D; &quot; + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SQL：UPDATE user SET deleted=1 WHERE deleted=0 AND name IS NULL AND age &gt;= ? AND email IS NOT NULL</p>
<h2 id="2、eq、ne"><a href="#2、eq、ne" class="headerlink" title="2、eq、ne"></a><strong>2、eq、ne</strong></h2><p><strong>注意：</strong>seletOne返回的是一条实体记录，当出现多条时会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectOne() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(&quot;name&quot;, &quot;Tom&quot;);</span><br><span class="line"></span><br><span class="line">    User user &#x3D; userMapper.selectOne(queryWrapper);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version FROM user WHERE deleted=0 AND name = ? </p>
<h2 id="3、between、notBetween"><a href="#3、between、notBetween" class="headerlink" title="3、between、notBetween"></a><strong>3、between、notBetween</strong></h2><p>包含大小边界</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectCount() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.between(&quot;age&quot;, 20, 30);</span><br><span class="line"></span><br><span class="line">    Integer count &#x3D; userMapper.selectCount(queryWrapper);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT COUNT(1) FROM user WHERE deleted=0 AND age BETWEEN ? AND ? </p>
<h2 id="4、allEq"><a href="#4、allEq" class="headerlink" title="4、allEq"></a><strong>4、allEq</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectList() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;id&quot;, 2);</span><br><span class="line">    map.put(&quot;name&quot;, &quot;Jack&quot;);</span><br><span class="line">    map.put(&quot;age&quot;, 20);</span><br><span class="line"></span><br><span class="line">    queryWrapper.allEq(map);</span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);</span><br><span class="line"></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version </p>
<p>FROM user WHERE deleted=0 AND name = ? AND id = ? AND age = ? </p>
<h2 id="5、like、notLike、likeLeft、likeRight"><a href="#5、like、notLike、likeLeft、likeRight" class="headerlink" title="5、like、notLike、likeLeft、likeRight"></a><strong>5、like、notLike、likeLeft、likeRight</strong></h2><p>selectMaps返回Map集合列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectMaps() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper</span><br><span class="line">        .notLike(&quot;name&quot;, &quot;e&quot;)</span><br><span class="line">        .likeRight(&quot;email&quot;, &quot;t&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps &#x3D; userMapper.selectMaps(queryWrapper);&#x2F;&#x2F;返回值是Map列表</span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version </p>
<p>FROM user WHERE deleted=0 AND name NOT LIKE ? AND email LIKE ? </p>
<h2 id="6、in、notIn、inSql、notinSql、exists、notExists"><a href="#6、in、notIn、inSql、notinSql、exists、notExists" class="headerlink" title="6、in、notIn、inSql、notinSql、exists、notExists"></a><strong>6、in、notIn、inSql、notinSql、exists、notExists</strong></h2><p>in、notIn：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notIn(&quot;age&quot;,&#123;1,2,3&#125;)---&gt;age not in (1,2,3)notIn(&quot;age&quot;, 1, 2, 3)---&gt;age not in (1,2,3)</span><br></pre></td></tr></table></figure>

<p>inSql、notinSql：可以实现子查询</p>
<ul>
<li>例: <code>inSql(&quot;age&quot;, &quot;1,2,3,4,5,6&quot;)</code>—&gt;<code>age in (1,2,3,4,5,6)</code></li>
<li>例: <code>inSql(&quot;id&quot;, &quot;select id from table where id &lt; 3&quot;)</code>—&gt;<code>id in (select id from table where id &lt; 3)</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectObjs() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    &#x2F;&#x2F;queryWrapper.in(&quot;id&quot;, 1, 2, 3);</span><br><span class="line">    queryWrapper.inSql(&quot;id&quot;, &quot;select id from user where id &lt; 3&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; objects &#x3D; userMapper.selectObjs(queryWrapper);&#x2F;&#x2F;返回值是Object列表</span><br><span class="line">    objects.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version </p>
<p>FROM user WHERE deleted=0 AND id IN (select id from user where id &lt; 3) </p>
<h2 id="7、or、and"><a href="#7、or、and" class="headerlink" title="7、or、and"></a><strong>7、or、and</strong></h2><p><strong>注意：</strong>这里使用的是 UpdateWrapper </p>
<p>不调用<code>or</code>则默认为使用 <code>and</code>连</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdate1() &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改值</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setAge(99);</span><br><span class="line">    user.setName(&quot;Andy&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改条件</span><br><span class="line">    UpdateWrapper&lt;User&gt; userUpdateWrapper &#x3D; new UpdateWrapper&lt;&gt;();</span><br><span class="line">    userUpdateWrapper</span><br><span class="line">        .like(&quot;name&quot;, &quot;h&quot;)</span><br><span class="line">        .or()</span><br><span class="line">        .between(&quot;age&quot;, 20, 30);</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.update(user, userUpdateWrapper);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UPDATE user SET name=?, age=?, update_time=? WHERE deleted=0 AND name LIKE ? OR age BETWEEN ? AND ?</p>
<h2 id="8、嵌套or、嵌套and"><a href="#8、嵌套or、嵌套and" class="headerlink" title="8、嵌套or、嵌套and"></a><strong>8、嵌套or、嵌套and</strong></h2><p>这里使用了lambda表达式，or中的表达式最后翻译成sql时会被加上圆括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdate2() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改值</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setAge(99);</span><br><span class="line">    user.setName(&quot;Andy&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改条件</span><br><span class="line">    UpdateWrapper&lt;User&gt; userUpdateWrapper &#x3D; new UpdateWrapper&lt;&gt;();</span><br><span class="line">    userUpdateWrapper</span><br><span class="line">        .like(&quot;name&quot;, &quot;h&quot;)</span><br><span class="line">        .or(i -&gt; i.eq(&quot;name&quot;, &quot;李白&quot;).ne(&quot;age&quot;, 20));</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.update(user, userUpdateWrapper);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UPDATE user SET name=?, age=?, update_time=? </p>
<p>WHERE deleted=0 AND name LIKE ? </p>
<p>OR ( name = ? AND age &lt;&gt; ? ) </p>
<h2 id="9、orderBy、orderByDesc、orderByAsc"><a href="#9、orderBy、orderByDesc、orderByAsc" class="headerlink" title="9、orderBy、orderByDesc、orderByAsc"></a><strong>9、orderBy、orderByDesc、orderByAsc</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectListOrderBy() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(&quot;id&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version </p>
<p>FROM user WHERE deleted=0 ORDER BY id DESC </p>
<h2 id="10、last"><a href="#10、last" class="headerlink" title="10、last"></a><strong>10、last</strong></h2><p>直接拼接到 sql 的最后</p>
<p><strong>注意：</strong>只能调用一次,多次调用以最后一次为准 有sql注入的风险,请谨慎使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectListLast() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.last(&quot;limit 1&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age,email,create_time,update_time,deleted,version </p>
<p>FROM user WHERE deleted=0 limit 1 </p>
<h2 id="11、指定要查询的列"><a href="#11、指定要查询的列" class="headerlink" title="11、指定要查询的列"></a><strong>11、</strong>指定要查询的列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectListColumn() &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper &#x3D; new QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.select(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SELECT id,name,age FROM user WHERE deleted=0 </p>
<h2 id="12、set、setSql"><a href="#12、set、setSql" class="headerlink" title="12、set、setSql"></a><strong>12、set、setSql</strong></h2><p>最终的sql会合并 user.setAge()，以及 userUpdateWrapper.set()  和 setSql() 中 的字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdateSet() &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改值</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setAge(99);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;修改条件</span><br><span class="line">    UpdateWrapper&lt;User&gt; userUpdateWrapper &#x3D; new UpdateWrapper&lt;&gt;();</span><br><span class="line">    userUpdateWrapper</span><br><span class="line">        .like(&quot;name&quot;, &quot;h&quot;)</span><br><span class="line">        .set(&quot;name&quot;, &quot;老李头&quot;)&#x2F;&#x2F;除了可以查询还可以使用set设置修改的字段</span><br><span class="line">        .setSql(&quot; email &#x3D; &#39;123@qq.com&#39;&quot;);&#x2F;&#x2F;可以有子查询</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.update(user, userUpdateWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UPDATE user SET age=?, update_time=?, name=?, email = ‘123@qq.com’ WHERE deleted=0 AND name LIKE ? </p>
<h1 id="一、insert"><a href="#一、insert" class="headerlink" title="一、insert"></a><strong>一、insert</strong></h1><h2 id="1、插入操作"><a href="#1、插入操作" class="headerlink" title="1、插入操作"></a><strong>1、插入操作</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class CRUDTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testInsert()&#123;</span><br><span class="line"></span><br><span class="line">        User user &#x3D; new User();</span><br><span class="line">        user.setName(&quot;Helen&quot;);</span><br><span class="line">        user.setAge(18);</span><br><span class="line">        user.setEmail(&quot;55317332@qq.com&quot;);</span><br><span class="line"></span><br><span class="line">        int result &#x3D; userMapper.insert(user);</span><br><span class="line">        System.out.println(result); &#x2F;&#x2F;影响的行数</span><br><span class="line">        System.out.println(user); &#x2F;&#x2F;id自动回填</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>数据库插入id值默认为：全局唯一id</p>
<p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/67ccbd19-bf21-41d8-a8a6-b88f3512aed9/128/index_files/93ff417f-c9f7-4225-b395-2afe2776183d.jpg)</p>
<h2 id="2、主键策略"><a href="#2、主键策略" class="headerlink" title="2、主键策略"></a>2、主键策略</h2><p><strong>（1）ID_WORKER</strong></p>
<p>MyBatis-Plus默认的主键策略是：ID_WORKER  <em>全局唯一ID</em></p>
<p><strong>参考资料：分布式系统唯一ID生成方案汇总：</strong><a href="https://www.cnblogs.com/haoxinyue/p/5208136.html" target="_blank" rel="noopener">https://www.cnblogs.com/haoxinyue/p/5208136.html</a></p>
<p><strong>（2）自增策略</strong></p>
<ul>
<li><p>要想主键自增需要配置如下主键策略</p>
</li>
<li><ul>
<li>需要在创建数据表的时候设置主键自增</li>
<li>实体字段中配置 @TableId(type = IdType.AUTO)</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@TableId(type &#x3D; IdType.AUTO)</span><br><span class="line">private Long id;</span><br></pre></td></tr></table></figure>

<p>要想影响所有实体的配置，可以设置全局主键配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#全局设置主键生成策略</span><br><span class="line">mybatis-plus.global-config.db-config.id-type&#x3D;auto</span><br></pre></td></tr></table></figure>

<p>其它主键策略：分析 IdType 源码可知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@Getter</span><br><span class="line">public enum IdType &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 数据库ID自增</span><br><span class="line">     *&#x2F;</span><br><span class="line">    AUTO(0),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 该类型为未设置主键类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    NONE(1),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 用户输入ID</span><br><span class="line">     * 该类型可以通过自己注册自动填充插件进行填充</span><br><span class="line">     *&#x2F;</span><br><span class="line">    INPUT(2),</span><br><span class="line"></span><br><span class="line">    &#x2F;* 以下3种类型、只有当插入对象ID 为空，才自动填充。 *&#x2F;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 全局唯一ID (idWorker)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    ID_WORKER(3),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 全局唯一ID (UUID)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    UUID(4),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 字符串全局唯一ID (idWorker 的字符串表示)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    ID_WORKER_STR(5);</span><br><span class="line"></span><br><span class="line">    private int key;</span><br><span class="line"></span><br><span class="line">    IdType(int key) &#123;</span><br><span class="line">        this.key &#x3D; key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、update"><a href="#二、update" class="headerlink" title="二、update"></a>二、update</h1><h2 id="1、根据Id更新操作"><a href="#1、根据Id更新操作" class="headerlink" title="1、根据Id更新操作"></a><strong>1、根据Id更新操作</strong></h2><p><strong>注意：</strong>update时生成的sql自动是动态sql：UPDATE user SET age=? WHERE id=? </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdateById()&#123;</span><br><span class="line"></span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setId(1L);</span><br><span class="line">    user.setAge(28);</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.updateById(user);</span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、自动填充"><a href="#2、自动填充" class="headerlink" title="2、自动填充"></a>2、自动填充</h2><p>项目中经常会遇到一些数据，每次都使用相同的方式填充，例如记录的创建时间，更新时间等。</p>
<p>我们可以使用MyBatis Plus的自动填充功能，完成这些字段的赋值工作：</p>
<p><strong>（1）数据库表中添加自动填充字段</strong></p>
<p>在User表中添加datetime类型的新的字段 create_time、update_time</p>
<p><strong>（2）实体上添加注解</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class User &#123;</span><br><span class="line">    ......</span><br><span class="line">        </span><br><span class="line">    @TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">    private Date createTime;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;@TableField(fill &#x3D; FieldFill.UPDATE)</span><br><span class="line">    @TableField(fill &#x3D; FieldFill.INSERT_UPDATE)</span><br><span class="line">    private Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（3）实现元对象处理器接口</strong></p>
<p><strong>注意：不要忘记添加 @Component 注解</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.mybatisplus.handler;</span><br><span class="line">import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line">import org.apache.ibatis.reflection.MetaObject;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class MyMetaObjectHandler implements MetaObjectHandler &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(MyMetaObjectHandler.class);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">        LOGGER.info(&quot;start insert fill ....&quot;);</span><br><span class="line">        this.setFieldValByName(&quot;createTime&quot;, new Date(), metaObject);</span><br><span class="line">        this.setFieldValByName(&quot;updateTime&quot;, new Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void updateFill(MetaObject metaObject) &#123;</span><br><span class="line">        LOGGER.info(&quot;start update fill ....&quot;);</span><br><span class="line">        this.setFieldValByName(&quot;updateTime&quot;, new Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（4）测试</strong></p>
<h2 id="3、乐观锁"><a href="#3、乐观锁" class="headerlink" title="3、乐观锁"></a>3、乐观锁</h2><p><strong>主要适用场景：</strong>当要更新一条记录的时候，希望这条记录没有被别人更新，也就是说实现线程安全的数据更新</p>
<p><strong>乐观锁实现方式：</strong></p>
<ul>
<li>取出记录时，获取当前version</li>
<li>更新时，带上这个version</li>
<li>执行更新时， set version = newVersion where version = oldVersion</li>
<li>如果version不对，就更新失败</li>
</ul>
<p><strong><em>\</em>（1）数据库中添加version字段**</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE &#96;user&#96; ADD COLUMN &#96;version&#96; INT</span><br></pre></td></tr></table></figure>



<p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/67ccbd19-bf21-41d8-a8a6-b88f3512aed9/128/index_files/7bf260f8-d483-49fe-b448-b2fbea3dddaf.png)</p>
<p><strong><em>\</em>（2）实体类添加version字段**</strong></p>
<p>并添加 @Version 注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Version</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Integer version;</span><br></pre></td></tr></table></figure>

<p><strong><em>\</em>（3）元对象处理器接口添加version的insert默认值**</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">    ......</span><br><span class="line">    this.setFieldValByName(&quot;version&quot;, 1, metaObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>特别说明:</strong></p>
<p>支持的数据类型只有 int,Integer,long,Long,Date,Timestamp,LocalDateTime整数类型下 <code>newVersion = oldVersion + 1``newVersion</code> 会回写到 <code>entity</code> 中仅支持 <code>updateById(id)</code> 与 <code>update(entity, wrapper)</code> 方法在 <code>update(entity, wrapper)</code> 方法下, <code>wrapper</code> 不能复用!!!</p>
<p><strong>（4）\</strong>在 MybatisPlusConfig 中注册 Bean****</p>
<p>创建配置类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.mybatisplus.config;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line">import org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">@Configuration</span><br><span class="line">@MapperScan(&quot;com.atguigu.mybatis_plus.mapper&quot;)</span><br><span class="line">public class MybatisPlusConfig &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 乐观锁插件</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public OptimisticLockerInterceptor optimisticLockerInterceptor() &#123;</span><br><span class="line">        return new OptimisticLockerInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（5）测试乐观锁可以修改成功</strong></p>
<p>测试后分析打印的sql语句，将version的数值进行了加1操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 测试 乐观锁插件</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testOptimisticLocker() &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;查询</span><br><span class="line">    User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">    &#x2F;&#x2F;修改数据</span><br><span class="line">    user.setName(&quot;Helen Yao&quot;);</span><br><span class="line">    user.setEmail(&quot;helen@qq.com&quot;);</span><br><span class="line">    &#x2F;&#x2F;执行更新</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（5）测试乐观锁修改失败</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 测试乐观锁插件 失败</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testOptimisticLockerFail() &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;查询</span><br><span class="line">    User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">    &#x2F;&#x2F;修改数据</span><br><span class="line">    user.setName(&quot;Helen Yao1&quot;);</span><br><span class="line">    user.setEmail(&quot;helen@qq.com1&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;模拟取出数据后，数据库中version实际数据比取出的值大，即已被其它线程修改并更新了version</span><br><span class="line">    user.setVersion(user.getVersion() - 1);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;执行更新</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、select"><a href="#三、select" class="headerlink" title="三、select"></a><strong>三、select</strong></h1><h2 id="1、根据id查询记录"><a href="#1、根据id查询记录" class="headerlink" title="1、根据id查询记录"></a><strong>1、根据id查询记录</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectById()&#123;</span><br><span class="line"></span><br><span class="line">    User user &#x3D; userMapper.selectById(1L);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、通过多个id批量查询"><a href="#2、通过多个id批量查询" class="headerlink" title="2、通过多个id批量查询"></a><strong>2、通过多个id批量查询</strong></h2><p>完成了动态sql的foreach的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectBatchIds()&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectBatchIds(Arrays.asList(1, 2, 3));</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、简单的条件查询"><a href="#3、简单的条件查询" class="headerlink" title="3、简单的条件查询"></a><strong>3、简单的条件查询</strong></h2><p>通过map封装查询条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectByMap()&#123;</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;name&quot;, &quot;Helen&quot;);</span><br><span class="line">    map.put(&quot;age&quot;, 18);</span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectByMap(map);</span><br><span class="line"></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>map中的key对应的是数据库中的列名。例如数据库user_id，实体类是userId，这时map的key需要填写user_id</p>
<h2 id="4、分页"><a href="#4、分页" class="headerlink" title="4、分页"></a>4、分页</h2><p>MyBatis Plus自带分页插件，只要简单的配置即可实现分页功能</p>
<p><strong>（1）创建配置类</strong></p>
<p>此时可以删除主类中的 <em>@MapperScan</em> 扫描注解**<br>**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 分页插件</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Bean</span><br><span class="line">public PaginationInterceptor paginationInterceptor() &#123;</span><br><span class="line">    return new PaginationInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（2）测试selectPage分页</strong></p>
<p><strong>测试：</strong>最终通过page对象获取相关数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectPage() &#123;</span><br><span class="line"></span><br><span class="line">    Page&lt;User&gt; page &#x3D; new Page&lt;&gt;(1,5);</span><br><span class="line">    userMapper.selectPage(page, null);</span><br><span class="line"></span><br><span class="line">    page.getRecords().forEach(System.out::println);</span><br><span class="line">    System.out.println(page.getCurrent());</span><br><span class="line">    System.out.println(page.getPages());</span><br><span class="line">    System.out.println(page.getSize());</span><br><span class="line">    System.out.println(page.getTotal());</span><br><span class="line">    System.out.println(page.hasNext());</span><br><span class="line">    System.out.println(page.hasPrevious());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台sql语句打印：SELECT id,name,age,email,create_time,update_time FROM user LIMIT 0,5 </p>
<p><strong>（3）测试selectMapsPage分页：结果集是Map</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSelectMapsPage() &#123;</span><br><span class="line"></span><br><span class="line">    Page&lt;User&gt; page &#x3D; new Page&lt;&gt;(1, 5);</span><br><span class="line"></span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; mapIPage &#x3D; userMapper.selectMapsPage(page, null);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;注意：此行必须使用 mapIPage 获取记录列表，否则会有数据类型转换错误</span><br><span class="line">    mapIPage.getRecords().forEach(System.out::println);</span><br><span class="line">    System.out.println(page.getCurrent());</span><br><span class="line">    System.out.println(page.getPages());</span><br><span class="line">    System.out.println(page.getSize());</span><br><span class="line">    System.out.println(page.getTotal());</span><br><span class="line">    System.out.println(page.hasNext());</span><br><span class="line">    System.out.println(page.hasPrevious());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、delete"><a href="#四、delete" class="headerlink" title="四、delete"></a>四、delete</h1><h2 id="1、根据id删除记录"><a href="#1、根据id删除记录" class="headerlink" title="1、根据id删除记录"></a><strong>1、根据id删除记录</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDeleteById()&#123;</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.deleteById(8L);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、批量删除"><a href="#2、批量删除" class="headerlink" title="2、批量删除"></a><strong>2、批量删除</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDeleteBatchIds() &#123;</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.deleteBatchIds(Arrays.asList(8, 9, 10));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、简单的条件查询删除"><a href="#3、简单的条件查询删除" class="headerlink" title="3、简单的条件查询删除"></a><strong>3、简单的条件查询删除</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDeleteByMap() &#123;</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;name&quot;, &quot;Helen&quot;);</span><br><span class="line">    map.put(&quot;age&quot;, 18);</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.deleteByMap(map);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、逻辑删除"><a href="#4、逻辑删除" class="headerlink" title="4、逻辑删除"></a>4、逻辑删除</h2><ul>
<li>物理删除：真实删除，将对应数据从数据库中删除，之后查询不到此条被删除数据</li>
<li>逻辑删除：假删除，将对应数据中代表是否被删除字段状态修改为“被删除状态”，之后在数据库中仍旧能看到此条数据记录</li>
</ul>
<p><strong>（1）数据库中添加 deleted字段</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE &#96;user&#96; ADD COLUMN &#96;deleted&#96; boolean</span><br></pre></td></tr></table></figure>

<p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/67ccbd19-bf21-41d8-a8a6-b88f3512aed9/128/index_files/bc4cbff4-c2b8-45d5-ae8d-53439dd2330c.png)</p>
<p><strong>（2）实体类添加deleted \</strong>字段****</p>
<p>并加上 @TableLogic 注解 和 @TableField(fill = FieldFill.INSERT) 注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@TableLogic</span><br><span class="line">@TableField(fill &#x3D; FieldFill.INSERT)</span><br><span class="line">private Integer deleted;</span><br></pre></td></tr></table></figure>

<p><strong>（3）元对象处理器接口添加deleted的insert默认值</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void insertFill(MetaObject metaObject) &#123;</span><br><span class="line">    ......</span><br><span class="line">    this.setFieldValByName(&quot;deleted&quot;, 0, metaObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（4）application.properties 加入配置</strong></p>
<p>此为默认值，如果你的默认值和mp默认的一样,该配置可无</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus.global-config.db-config.logic-delete-value&#x3D;1</span><br><span class="line">mybatis-plus.global-config.db-config.logic-not-delete-value&#x3D;0</span><br></pre></td></tr></table></figure>

<p><strong>（5）在 MybatisPlusConfig 中注册 Bean</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ISqlInjector sqlInjector() &#123;</span><br><span class="line">    return new LogicSqlInjector();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（6）测试逻辑删除</strong></p>
<ul>
<li>测试后发现，数据并没有被删除，deleted字段的值由0变成了1</li>
<li>测试后分析打印的sql语句，是一条update</li>
<li><strong>注意：</strong>被删除数据的deleted 字段的值必须是 0，才能被选取出来执行逻辑删除的操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 测试 逻辑删除</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testLogicDelete() &#123;</span><br><span class="line"></span><br><span class="line">    int result &#x3D; userMapper.deleteById(1L);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（7）测试逻辑删除后的查询</strong></p>
<p>MyBatis Plus中查询操作也会自动添加逻辑删除字段的判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 测试 逻辑删除后的查询：</span><br><span class="line"> * 不包括被逻辑删除的记录</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testLogicDeleteSelect() &#123;</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    List&lt;User&gt; users &#x3D; userMapper.selectList(null);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试后分析打印的sql语句，包含 WHERE deleted=0 </p>
<p>SELECT id,name,age,email,create_time,update_time,deleted FROM user WHERE deleted=0</p>
<h1 id="五、性能分析"><a href="#五、性能分析" class="headerlink" title="五、性能分析"></a>五、性能分析</h1><p>性能分析拦截器，用于输出每条 SQL 语句及其执行时间</p>
<p>SQL 性能执行分析,开发环境使用，超过指定时间，停止运行。有助于发现问题</p>
<h2 id="1、配置插件"><a href="#1、配置插件" class="headerlink" title="1、配置插件"></a>1、配置插件</h2><p><strong>（1）参数说明</strong></p>
<p>参数：maxTime： SQL 执行最大时长，超过自动停止运行，有助于发现问题。</p>
<p>参数：format： SQL是否格式化，默认false。</p>
<p><strong>（2）在 MybatisPlusConfig 中配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * SQL 执行性能分析插件</span><br><span class="line"> * 开发环境使用，线上不推荐。 maxTime 指的是 sql 最大执行时长</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Bean</span><br><span class="line">@Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)&#x2F;&#x2F; 设置 dev test 环境开启</span><br><span class="line">public PerformanceInterceptor performanceInterceptor() &#123;</span><br><span class="line">    PerformanceInterceptor performanceInterceptor &#x3D; new PerformanceInterceptor();</span><br><span class="line">    performanceInterceptor.setMaxTime(100);&#x2F;&#x2F;ms，超过此处设置的ms则sql不执行</span><br><span class="line">    performanceInterceptor.setFormat(true);</span><br><span class="line">    return performanceInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（3）Spring Boot 中设置dev环境</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#环境设置：dev、test、prod</span><br><span class="line">spring.profiles.active&#x3D;dev</span><br></pre></td></tr></table></figure>

<p>可以针对各环境新建不同的配置文件<code>application-dev.properties</code>、<code>application-test.properties</code>、<code>application-prod.properties</code></p>
<p>也可以自定义环境名称：如test1、test2</p>
<h2 id="2、测试"><a href="#2、测试" class="headerlink" title="2、测试"></a>2、测试</h2><p><strong>（1）常规测试</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 测试 性能分析插件</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testPerformance() &#123;</span><br><span class="line">    User user &#x3D; new User();</span><br><span class="line">    user.setName(&quot;我是Helen&quot;);</span><br><span class="line">    user.setEmail(&quot;helen@sina.com&quot;);</span><br><span class="line">    user.setAge(18);</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出：</strong></p>
<p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/67ccbd19-bf21-41d8-a8a6-b88f3512aed9/128/index_files/bb355a17-3cdc-4f0a-82f2-232defbd235b.png)</p>
<p><strong>（2）将maxTime 改小之后再次进行测试</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">performanceInterceptor.setMaxTime(5);&#x2F;&#x2F;ms，超过此处设置的ms不执行</span><br></pre></td></tr></table></figure>

<p>如果执行时间过长，则抛出异常：The SQL execution time is too large, </p>
<p><strong>输出：</strong></p>
<p>![img](file:///C:/Users/yafeng/Documents/My Knowledge/temp/67ccbd19-bf21-41d8-a8a6-b88f3512aed9/128/index_files/1ae5ae68-b6b2-4801-ae26-29835b175b24.png)</p>
<h1 id="六、其它"><a href="#六、其它" class="headerlink" title="六、其它"></a>六、其它</h1><p>如果想进行复杂条件查询，那么需要使用条件构造器 Wapper，涉及到如下方法</p>
<p><strong>1、delete</strong></p>
<p><strong>2、selectOne</strong></p>
<p><strong>3、selectCount</strong></p>
<p><strong>4、selectList</strong></p>
<p><strong>5、selectMaps</strong></p>
<p><strong>6、selectObjs</strong></p>
<p><strong>7、update</strong></p>
<h3 id="1-mybatisplus查询某一天的数据-条件构造器"><a href="#1-mybatisplus查询某一天的数据-条件构造器" class="headerlink" title="1. mybatisplus查询某一天的数据(条件构造器)"></a>1. <code>mybatisplus</code>查询某一天的数据(条件构造器)</h3><p>​        首先,对于复杂的查询,只往查询条件里面塞一个实体是解决不了的,就需要</p>
<p><code>new QueryWrapper&lt;&gt;(entity).apply(&quot;date_format(create_time,&#39;%Y-%m-%d&#39;) = &#39;&quot;+createTime+&quot;&#39;&quot;).orderByDesc(&quot;create_time&quot;).select(ConstansValue.sampleOrderList));</code></p>
<p>先new 一个 QueryWrapper传入相应的参数,进行对应的操作(有很多),也有对应的updateWrapper,再已提供的方法不够用时,可以使用appley(“”),相当于自定义一个方法,也就是拼sql.</p>
<p>这里的问题是使用的mysql的格式化时间函数,将数据库中的createTime格式化为<code>yyyy-MM-dd</code>的格式,再将传进来的参数也格式化为该格式然后做=匹配 .可能效率略差</p>
<p>复杂的查询可以参考mybatisplus的条件构造器,但是也要考虑传空值的情况</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/idea%E5%BF%AB%E6%8D%B7%E9%94%AE/">idea快捷键</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><p><strong>自动代码</strong></p>
<p>常用的有fori/sout/psvm+Tab即可生成循环、System.out、main方法等boilerplate样板代码 。</p>
<p><em>例如要输入for(User user : users)只需输入user.for+Tab ；</em></p>
<p><em>再比如，要输入Date birthday = user.getBirthday()只需输入user.getBirthday().var+Tab即可。</em></p>
<p>代码标签输入完成后，按Tab，生成代码。</p>
<ol>
<li>Ctrl+Alt+O 优化导入的类和包 </li>
<li>Alt+Insert 生成代码(如get,set方法,构造函数等)  或者右键（Generate） </li>
<li>fori/sout/psvm + Tab </li>
<li>Ctrl+Alt+T 生成try catch 或者 Alt+enter </li>
<li>CTRL+ALT+T 把选中的代码放在 TRY{} IF{} ELSE{} 里 </li>
<li>Ctrl + O 重写方法 </li>
<li>Ctrl + I 实现方法 </li>
<li>Ctr+shift+U 大小写转化 </li>
<li>ALT+回车  导入包,自动修正 </li>
<li>ALT+/    代码提示 </li>
<li>CTRL+J   自动代码 </li>
<li>Ctrl+Shift+J，整合两行为一行 </li>
<li>CTRL+空格  代码提示 </li>
<li>CTRL+SHIFT+SPACE 自动补全代码 </li>
<li>CTRL+ALT+L 格式化代码 </li>
<li>CTRL+ALT+I 自动缩进 </li>
<li>CTRL+ALT+O 优化导入的类和包 </li>
<li>ALT+INSERT 生成代码(如GET,SET方法,构造函数等) </li>
<li>CTRL+E   最近更改的代码 </li>
<li>CTRL+ALT+SPACE 类名或接口名提示 </li>
<li>CTRL+P  方法参数提示 </li>
<li>CTRL+Q，可以看到当前方法的声明 </li>
<li>Shift+F6 重构-重命名 (包、类、方法、变量、甚至注释等) </li>
<li>Ctrl+Alt+V 提取变量 </li>
</ol>
<p><strong>查询快捷键</strong></p>
<ol>
<li>Ctrl＋Shift＋Backspace可以跳转到上次编辑的地 </li>
<li>CTRL+ALT+ left/right 前后导航编辑过的地方 </li>
<li>ALT+7 靠左窗口显示当前文件的结构 </li>
<li>Ctrl+F12 浮动显示当前文件的结构 </li>
<li>ALT+F7 找到你的函数或者变量或者类的所有引用到的地方 </li>
<li>CTRL+ALT+F7 找到你的函数或者变量或者类的所有引用到的地方 </li>
<li>Ctrl+Shift+Alt+N 查找类中的方法或变量 </li>
<li>双击SHIFT 在项目的所有目录查找文件 </li>
<li>Ctrl+N  查找类 </li>
<li>Ctrl+Shift+N 查找文件 </li>
<li>CTRL+G  定位行 </li>
<li>CTRL+F  在当前窗口查找文本 </li>
<li>CTRL+SHIFT+F 在指定窗口查找文本 </li>
<li>CTRL+R  在 当前窗口替换文本 </li>
<li>CTRL+SHIFT+R 在指定窗口替换文本 </li>
<li>ALT+SHIFT+C 查找修改的文件 </li>
<li>CTRL+E  最近打开的文件 </li>
<li>F3  向下查找关键字出现位置 </li>
<li>SHIFT+F3 向上一个关键字出现位置 </li>
<li>选中文本，按Alt+F3 ，高亮相同文本，F3逐个往下查找相同文本 </li>
<li>F4  查找变量来源 </li>
<li>CTRL+SHIFT+O 弹出显示查找内容 </li>
<li>Ctrl+W 选中代码，连续按会有其他效果 </li>
<li>F2 或Shift+F2 高亮错误或警告快速定位 </li>
<li>Ctrl+Up/Down 光标跳转到第一行或最后一行下 </li>
<li>Ctrl+B 快速打开光标处的类或方法 </li>
<li>CTRL+ALT+B 找所有的子类 </li>
<li>CTRL+SHIFT+B 找变量的类 </li>
<li>Ctrl+Shift+上下键 上下移动代码 </li>
<li>Ctrl+Alt+ left/right 返回至上次浏览的位置 </li>
<li>Ctrl+X 删除行 </li>
<li>Ctrl+D 复制行 </li>
<li>Ctrl+/ 或 Ctrl+Shift+/ 注释（// 或者/<em>…</em>/ ） </li>
<li>Ctrl+H 显示类结构图 </li>
<li>Ctrl+Q 显示注释文档 </li>
<li>Alt+F1 查找代码所在位置 </li>
<li>Alt+1 快速打开或隐藏工程面板 </li>
<li>Alt+ left/right 切换代码视图 </li>
<li>ALT+ ↑/↓ 在方法间快速移动定位 </li>
<li>CTRL+ALT+ left/right 前后导航编辑过的地方 </li>
<li>Ctrl＋Shift＋Backspace可以跳转到上次编辑的地 </li>
<li>Alt+6  查找TODO </li>
</ol>
<p><strong>其他快捷键</strong></p>
<ol>
<li>SHIFT+ENTER 另起一行 </li>
<li>CTRL+Z  倒退(撤销) </li>
<li>CTRL+SHIFT+Z 向前(取消撤销) </li>
<li>CTRL+ALT+F12 资源管理器打开文件夹 </li>
<li>ALT+F1  查找文件所在目录位置 </li>
<li>SHIFT+ALT+INSERT 竖编辑模式 </li>
<li>CTRL+F4 关闭当前窗口 </li>
<li>Ctrl+Alt+V，可以引入变量。例如：new String(); 自动导入变量定义 </li>
<li>Ctrl+~，快速切换方案（界面外观、代码风格、快捷键映射等菜单） </li>
</ol>
<p><strong>svn快捷键</strong></p>
<ol>
<li>ctrl+k 提交代码到SVN </li>
<li>ctrl+t 更新代码 </li>
</ol>
<p><strong>调试快捷键</strong></p>
<p>其实常用的 就是F8 F7 F9 最值得一提的就是Drop Frame 可以让运行过的代码从头再来。</p>
<ol>
<li>alt+F8  debug时选中查看值 </li>
<li>Alt+Shift+F9，选择 Debug </li>
<li>Alt+Shift+F10，选择 Run </li>
<li>Ctrl+Shift+F9，编译 </li>
<li>Ctrl+Shift+F8，查看断点 </li>
<li>F7，步入 </li>
<li>Shift+F7，智能步入 </li>
<li>Alt+Shift+F7，强制步入 </li>
<li>F8，步过 </li>
<li>Shift+F8，步出 </li>
<li>Alt+Shift+F8，强制步过 </li>
<li>Alt+F9，运行至光标处 </li>
<li>Ctrl+Alt+F9，强制运行至光标处 </li>
<li>F9，恢复程序 </li>
<li>Alt+F10，定位到断点 </li>
</ol>
<p><strong>重构</strong></p>
<ol>
<li>Ctrl+Alt+Shift+T，弹出重构菜单 </li>
<li>Shift+F6，重命名 </li>
<li>F6，移动 </li>
<li>F5，复制 </li>
<li>Alt+Delete，安全删除 </li>
<li>Ctrl+Alt+N，内联 </li>
</ol>
<p><strong>十大Intellij IDEA快捷键</strong> </p>
<p>Intellij IDEA中有很多快捷键让人爱不释手，stackoverflow上也有一些有趣的讨论。每个人都有自己的最爱，想排出个理想的榜单还真是困难。 </p>
<p>以前也整理过Intellij的快捷键，这次就按照我日常开发时的使用频率，简单分类列一下我最喜欢的十大快捷-神-键吧。 </p>
<p><strong>1 智能提示:</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2019.2.1\bin\jetbrains-agent.jar</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/Docker%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA/">Docker数据卷挂载宿主机</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><h1 id="Docker-挂载宿主机文件-目录"><a href="#Docker-挂载宿主机文件-目录" class="headerlink" title="Docker 挂载宿主机文件/目录"></a>Docker 挂载宿主机文件/目录</h1><pre><code>这个问题困扰了很久,上次挂载`redis`的配置文件,就折腾了好久,这次配置`nginx`的配置文件/目录,又忙活了两个小时,其实挂载目录是没什么的问题的,关键是加上了配置文件之后,就会导致容器启动失败,后来百般搜索,从一个大神这找到了问题 ,链接`[https://blog.csdn.net/ii19910410/article/details/88639320?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522158519158119725219964887%2522%252C%2522scm%2522%253A%252220140713.130056874..%2522%257D&amp;request_id=158519158119725219964887&amp;biz_id=0&amp;utm_source=distribute.pc_search_result.none-task](https://blog.csdn.net/ii19910410/article/details/88639320?ops_request_misc=%7B%22request%5Fid%22%3A%22158519158119725219964887%22%2C%22scm%22%3A%2220140713.130056874..%22%7D&amp;request_id=158519158119725219964887&amp;biz_id=0&amp;utm_source=distribute.pc_search_result.none-task)`.</code></pre><p>​        问题的关键是 ,再挂载配置的文件的时候,要提前将配置文件的目录创建好,将配置文件copy过来,最好是官方的配置文件,然后在挂载配置文件的这个地方,注意挂载的是文件,而不是目录. 我的运行命令如下<code>docker run -p 80:80 --name dockerNginx --privileged=true -v /yafenguse/mynginx/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v /yafenguse/mynginx/nginx/conf/nginx.conf:/etc/nginx/nginx.conf  -v /yafenguse/mynginx/nginx/logs:/var/log/nginx  -v /yafenguse/mynginx/nginx/html:/usr/share/nginx/html -d nginx</code>,</p>
<p>以下是配置文件的挂载(切记提前创建):</p>
<p><code>/yafenguse/mynginx/nginx/conf/nginx.conf:/etc/nginx/nginx.conf</code></p>
<p>最为关键的是以下命令:<code>--privileged=true</code>,原因是配置了配置文件以后,容器可能启动不成功,就使用该命令</p>
<p>​        百度之后得知,该命令相当于是已<code>root</code>权限使用    <code>docker</code>启动容器,可能是挂载宿主机的配置文件时,普通的用户权限无效吧,以下是百度的解释:</p>
<pre><code>大约在0.6版，privileged被引入docker。</code></pre><p>使用该参数，container内的root拥有真正的root权限。<br>否则，container内的root只是外部的一个普通用户权限。<br>privileged启动的容器，可以看到很多host上的设备，并且可以执行mount。<br>甚至允许你在docker容器中启动docker容器。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/15/hello-world/">Hello World</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-15</time><div class="content"><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By 丰之霸</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>